<?php
use yii\helpers\Html;
use yii\widgets\ActiveForm;
/** @var $model app\modules\install\models\PhpCheckForm */
?>
<h1>Шаг 1: Проверка хоста и лицензия</h1>

<!-- Лицензия -->
<div class="card mb-4">
    <div class="card-header bg-dark text-white">Лицензионное соглашение проекта Oasis</div>
    <div class="card-body" style="max-height: 250px; overflow-y: auto; background:#f8f9fa; white-space: pre-line; font-size:14px;">
1. Разрешается

1.1. Использовать исходный код Oasis в любых проектах (личных, коммерческих, игровых, веб-проектах и сервисах).
1.2. Вносить изменения и адаптировать код под собственные нужды.
1.3. Создавать шаблоны, дополнения и модифицированные версии для своих проектов.
	1.3.1. Авторы модификаций вправе указывать собственные лицензии на свои работы.
	1.3.2. Лицензия на модификации считается действительной с момента её публикации официальным автором или уполномоченным лицом.
1.4. Распространять модифицированные версии Oasis при условии сохранения открытого исходного кода и указания оригинального автора (правообладателя).
1.5. Получать доход от проектов, которые используют Oasis.
1.6. Публиковать дополнения (модули, плагины, темы и пр.) на любых ресурсах и условиях, если это не нарушает права третьих лиц.
1.7. Использовать и распространять материалы, предоставленные правообладателем Oasis или его уполномоченными лицами, если они опубликованы в свободном доступе или приобретены на законных основаниях.
1.8. Разрабатывать собственные производные продукты (например, дизайн, стили, темы), если они не нарушают права третьих лиц.
1.9. Требовать удаления любых модификаций, нарушающих авторские права, при предоставлении доказательств авторства или права собственности.
1.10. Продавать собственные дополнения и модификации, интегрированные в Oasis, при условии, что чётко указано: продаётся именно модификация, а не сам Oasis.
1.11. Обжаловать нарушения настоящего соглашения в установленном законом порядке по месту жительства автора (правообладателя).
1.12. Создавать аналогичные модификации, вдохновляясь другими проектами, при условиях:
	1.12.1. Это не является полной или частичной копией дизайна или кода без согласия правообладателя.
	1.12.2. Не используется интеллектуальная собственность третьих лиц без их согласия.
	1.12.3. Модификация для Oasis не считается копией, если имеет явные визуальные отличия, достаточные для того, чтобы любой среднестатистический пользователь с нормальным зрением мог легко отличить её от оригинального шаблона. Только в этом случае такая модификация признаётся самостоятельным сторонним авторским дополнением.
	1.12.4. Нарушение данных условий лишает автора права позиционировать свою работу как дополнение к Oasis, а правообладатель получает право требовать её удаления.
1.13. Автором модификации признаётся пользователь, впервые разместивший её на официальной площадке (например, GitHub), при условии соблюдения настоящей лицензии.
	1.13.1. Споры об авторстве модификаций, размещённых на GitHub, разрешаются в арбитраже данной платформы.
1.14. Авторами модификаций также признаются пользователи других ресурсов, если они могут доказать своё авторство.
	1.14.1. Споры об авторских правах на дополнения решаются пользователями самостоятельно в рамках действующего законодательства своих регионов.
1.15. Автор или правообладатель модификаций и дополнений в одностороннем порядке решает, как, где и кем может быть использовано дополнение или модификация, при условии что это не противоречит пункту 6.1 данного соглашения.
	1.15.1. Однако автор остаётся ограничен данным лицензионным соглашением, и его дополнения и модификации не могут нарушать это соглашение частично или полностью.
1.16. Все авторы и владельцы дополнений к Oasis имеют право ссылаться на данное лицензионное соглашение для урегулирования всех спорных вопросов, связанных с использованием продукта Oasis, если это не противоречит пунктам 2.16 и 2.16.1.
1.17. Пользователь вправе использовать любые шаблоны, дизайн-решения, логотипы и иные материалы, которые входят в состав официального издания Oasis, распространяемого автором. Использование этих материалов является правом, но не обязательством.
1.18. Пользователь имеет право создавать собственные шаблоны, дизайн-решения, логотипы и иные визуальные элементы с нуля и использовать их в проектах на базе Oasis без ограничений. Такие работы не считаются нарушением условий настоящей лицензии, даже если они полностью заменяют или не используют материалы официального издания.
1.19. Пользователь имеет право использовать сторонние а так же собственные шаблоны и дизайн-решения, при условии что это не нарушает прав третьих лиц и не нарушает пункта 3.3 настоящего соглашения.
	1.19.1. Условие пункта 1.19 не распространяется на шаблоны и материалы, включённые в официальный релиз Oasis. При их использовании «как есть» пользователь считается автоматически соблюдающим требования настоящего соглашения. Это условие не касается ссылок и их названий в главном меню сайта, а также динамического текста, который используется внутри шаблона и может быть изменён пользователем в любой момент на любой удобный текст.

2. Запрещается

2.1. Отзывать ранее предоставленные бесплатные лицензии на модификации, кроме случаев:
	2.1.1. Нарушения условий лицензии пользователем.
	2.1.2. Истечения срока действия (если он был установлен заранее).
	2.1.3. Использования модификации в незаконных целях.
	2.1.4. Предоставления ложных данных при получении лицензии.
2.2. Распространять изменённые версии Oasis без указания полного списка изменений.
2.3. Копировать чужие проекты полностью или частично без согласия владельцев.
2.4. Распространять чужие модификации Oasis без согласия их авторов.
2.5. Использовать сторонние дополнения без согласия их авторов или уполномоченных лиц.
2.6. Использовать Oasis для мошенничества, фишинга, незаконного сбора данных или иной противоправной деятельности.
2.7. Продавать исходный код Oasis полностью или частично как самостоятельный продукт.
2.8. Распространять модифицированные версии Oasis под другим названием как отдельный движок, CMS или платформу.
2.9. Присваивать авторство Oasis или публиковать его от своего имени без указания оригинального автора.
2.10. Распространять Oasis или его части в архивах с паролями или форматах, ограничивающих свободный доступ.
2.11. Размещать Oasis на платных площадках, файлообменниках или сервисах, требующих оплату за скачивание.
2.12. Удалять или изменять данную лицензию без согласия правообладателя.
2.13. Использовать Oasis, если это нарушает законы страны или региона, где он применяется.
	2.13.1. В таком случае хостинг-провайдер имеет право удалить проект без компенсации.
2.14. Использовать Oasis в юрисдикциях, где это нарушает действующее законодательство.
	2.14.1. В таких случаях хостинг вправе передать данные правоохранительным органам.
2.15. Передавать третьим лицам конфиденциальные данные пользователей (переписку, историю покупок, аккаунты), кроме случаев, предусмотренных законом.
2.16. Присваивать себе авторство Oasis или модификаций без согласия их авторов.
	2.16.1. При нарушении данного пункта лицензия аннулируется безвозвратно. Пользователь обязан немедленно удалить все копии Oasis и модификации.
	2.16.2. Авторы модификаций вправе требовать от хостингов и обменников немедленного удаления продукта у нарушителя.
	2.16.3. Присвоением авторства считается также изменение названия продукта без ссылки на оригинального автора.
	2.16.4. Размещение Oasis на ресурсах с указанием или намёком на «официальный источник» без согласия автора.
	2.16.5. Исключение: случаи, когда права были переданы новым владельцам на законных основаниях.
	2.16.6. Восстановление лицензии возможно только после урегулирования претензий автора и официального уведомления о снятии конфликта.

3. Обязательные условия

3.1. При использовании Oasis необходимо сохранять видимую ссылку на официальный проект.
3.2. Упоминание Oasis не должно вводить в заблуждение: проект не является продолжением GHTWEB 5.
3.3. Ссылка на официальный сайт Oasis должна присутствовать на главной странице или в подвале проекта.
	3.3.1. Допускается размещение ссылки в социальных сетях или форумах, если на сайте проекта указана основная ссылка.
	3.3.2. Допускается размещение логотипа Oasis со ссылкой на официальный ресурс.
3.4. Перед публикацией собственных модификаций пользователь обязан ознакомиться с актуальной версией лицензии на официальных ресурсах Oasis.

4. Авторские права

4.1. Все исключительные права на исходный код Oasis принадлежат автору (правообладателю).
4.2. Правообладатель вправе отзывать лицензию у нарушителей условий.
4.3. Пользователи сохраняют право использовать ранее полученные лицензии, кроме случаев:
	4.3.1. Присвоения авторства Oasis.
	4.3.2. Нарушения настоящего соглашения.
	4.3.3. Нарушения прав третьих лиц.
	4.3.4. Намеренного введения в заблуждение.
	4.3.5. Использования продукта для пропаганды ненависти или дискриминации.
4.4. Автор оставляет за собой право изменять данную лицензию.
	4.4.1. Пользователи вправе использовать версии Oasis на условиях лицензии, действовавшей в момент получения продукта.

5. Ограничение ответственности

5.1. Oasis предоставляется «как есть», без гарантий.
5.2. Автор не несёт ответственности за убытки, вызванные использованием Oasis.
5.3. Автор не несёт ответственности за сторонние модификации.
5.4. Пользователь несёт полную ответственность за изменения и распространение кода.
5.5. Автор не несёт ответственности за взаимодействие Oasis со сторонними сервисами и ПО.

6. Заключительные положения

6.1. Пользователи сохраняют право использовать ранее полученные сторонние модификации в рамках их лицензий.
6.2. Передавая свои модификации для включения в официальный релиз Oasis, автор соглашается на их свободное распространение.
6.3. При нарушении условий лицензии пользователь утрачивает право использовать Oasis и обязан удалить все копии.
6.4. Правообладатель вправе требовать удаления Oasis с любых площадок при нарушении условий.
6.5. Настоящая лицензия не является лицензией OSI или SPDX, но выполняет функцию защиты и регулирования использования Oasis.
6.6. Незнание условий настоящей лицензии не освобождает пользователя от ответственности.
6.7. Используя Oasis, вы также соглашаетесь с лицензией Yii2:
https://github.com/yiisoft/yii2/blob/master/LICENSE.md
    </div>
</div>

<!-- Чекбокс согласия -->
<?php $form = ActiveForm::begin(); ?>
    <div class="form-check mb-3">
        <input type="checkbox" class="form-check-input" id="acceptLicense" required>
        <label class="form-check-label" for="acceptLicense">
            Я принимаю условия соглашения
        </label>
    </div>
<?php ActiveForm::end(); ?>


<h2>Проверка окружения</h2>
<ul>
    <li>PHP ≥ 8.2:
        <b class="text-<?= $model->checkPhp()?'success':'danger' ?>">
            <?= $model->checkPhp()?'Да':'Нет' ?>
        </b>
    </li>
    <li>PDO MySQL:
        <b class="text-<?= $model->checkPdo()?'success':'danger' ?>">
            <?= $model->checkPdo()?'Да':'Нет' ?>
        </b>
    </li>
    <li>GD extension:
        <b class="text-<?= $model->checkGd()?'success':'danger' ?>">
            <?= $model->checkGd()?'Да':'Нет' ?>
        </b>
    </li>
    <li>mod_rewrite:
        <b class="text-<?= $model->checkModRewrite()?'success':'danger' ?>">
            <?= $model->checkModRewrite()?'Да':'Нет' ?>
        </b>
    </li>
    <li>Запись в <code>protected/runtime/logs/app.log</code>:
        <b class="text-<?= $model->checkLogWritable()?'success':'danger' ?>">
            <?= $model->checkLogWritable()?'Да':'Нет' ?>
        </b>
    </li>
    <li>Запись в <code>online.txt</code>:
        <b class="text-<?= $model->checkOnlineTxtWritable()?'success':'danger' ?>">
            <?= $model->checkOnlineTxtWritable()?'Да':'Нет' ?>
        </b>
    </li>
    <li>Запись в <code>robots.txt</code>:
        <b class="text-<?= $model->checkRobotsTxtWritable()?'success':'danger' ?>">
            <?= $model->checkRobotsTxtWritable()?'Да':'Нет' ?>
        </b>
    </li>

    <?php if ($model->checkInstallDirWritable() !== null): ?>
        <li>Права на папку <code>protected/modules/install</code> (777):
            <b class="text-<?= $model->checkInstallDirWritable()?'success':'danger' ?>">
                <?= $model->checkInstallDirWritable()?'Да':'Нет' ?>
            </b>
        </li>
    <?php endif; ?>
</ul>

<?php
$allChecks = $model->checkPhp()
    && $model->checkPdo()
    && $model->checkGd()
    && $model->checkModRewrite()
    && $model->checkLogWritable()
    && $model->checkOnlineTxtWritable()
    && $model->checkRobotsTxtWritable();

if ($model->checkInstallDirWritable() !== null) {
    $allChecks = $allChecks && $model->checkInstallDirWritable();
}
?>

<?php if ($allChecks): ?>
    <button id="nextBtn" class="btn btn-primary" disabled>Дальше</button>
    <script>
        const checkbox = document.getElementById('acceptLicense');
        const nextBtn = document.getElementById('nextBtn');
        checkbox.addEventListener('change', () => {
            nextBtn.disabled = !checkbox.checked;
            if (checkbox.checked) {
                nextBtn.onclick = () => window.location.href = '<?= \yii\helpers\Url::to(['step2']) ?>';
            } else {
                nextBtn.onclick = null;
            }
        });
    </script>
<?php else: ?>
    <p class="alert alert-danger">
        Исправьте ошибки выше, чтобы продолжить установку.
    </p>
<?php endif; ?>
